/**
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚                     DATA FACTORY GENERATOR TEST                          â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ Tests unitaires pour la gÃ©nÃ©ration de donnÃ©es de test                    â”‚
 * â”‚ Version: 1.0                                                             â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 * @description       : Une classe de test pour dÃ©montrer l'utilisation de DataFactoryG.cls.
 * @author            : Mamadou Lamine CAMARA
 * @group             : 
 * @last modified on  : 20-04-2025 
 * @last modified by  : Mamadou Lamine CAMARA
**/

@IsTest
public class DataFactoryGTest {
    
    //â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    //â”‚    TESTS DES OBJETS SIMPLES             â”‚
    //â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    /**
     * @description Test de crÃ©ation d'un compte simple
     */
    @IsTest
    static void testCreateSingleAccount() {
        // ğŸ“ PrÃ©paration des donnÃ©es
        Map<String, Object> accountFields = new Map<String, Object>{
            'Name' => 'Test Account',
            'Phone' => DataFactoryG.generateRandomPhone(),
            'Website' => 'www.test.com'
        };
        
        // â–¶ï¸ ExÃ©cution du test
        Test.startTest();
        Account acc = (Account)DataFactoryG.createSObject('Account', accountFields);
        insert acc;
        Test.stopTest();
        
        // âœ… VÃ©rification
        Account insertedAcc = [SELECT Id, Name, Phone, Website FROM Account WHERE Id = :acc.Id];
        System.assertEquals('Test Account', insertedAcc.Name);
        System.assertEquals(accountFields.get('Website'), insertedAcc.Website);
    }
    
    /**
     * @description Test de crÃ©ation de plusieurs contacts
     */
    @IsTest
    static void testCreateMultipleContacts() {
        // ğŸ“ PrÃ©paration des donnÃ©es
        Integer numberOfContacts = 5;
        Map<String, Object> contactFields = new Map<String, Object>{
            'LastName' => 'Test Contact',
            'Email' => DataFactoryG.generateRandomEmail()
        };
        
        // â–¶ï¸ ExÃ©cution du test
        Test.startTest();
        List<SObject> contacts = DataFactoryG.createSObjectList('Contact', numberOfContacts, contactFields);
        insert contacts;
        Test.stopTest();
        
        // âœ… VÃ©rification
        List<Contact> insertedContacts = [SELECT Id FROM Contact];
        System.assertEquals(numberOfContacts, insertedContacts.size());
    }
    
    //â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    //â”‚    TESTS DES GÃ‰NÃ‰RATEURS                â”‚
    //â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    /**
     * @description Test des gÃ©nÃ©rateurs de donnÃ©es alÃ©atoires
     */
    @IsTest
    static void testRandomGenerators() {
        // ğŸ² Test de gÃ©nÃ©ration de chaÃ®ne alÃ©atoire
        String randomStr = DataFactoryG.generateRandomString(10);
        System.assertEquals(10, randomStr.length());
        
        // ğŸ“§ Test de gÃ©nÃ©ration d'email
        String email = DataFactoryG.generateRandomEmail();
        System.assert(email.contains('@'));
        
        // ğŸ“± Test de gÃ©nÃ©ration de numÃ©ro de tÃ©lÃ©phone
        String phone = DataFactoryG.generateRandomPhone();
        System.assert(phone.startsWith('+33'));
        System.assertEquals(12, phone.length());
    }
    
    /**
     * @description Test de crÃ©ation d'un utilisateur
     */
    @IsTest
    static void testCreateUser() {
        // ğŸ‘¤ PrÃ©paration du profil
        Profile p = [SELECT Id FROM Profile WHERE Name = 'Standard User' LIMIT 1];
        
        // ğŸ“ PrÃ©paration des donnÃ©es utilisateur
        Map<String, Object> userFields = new Map<String, Object>{
            'LastName' => 'Test User',
            'Email' => DataFactoryG.generateRandomEmail(),
            'Alias' => DataFactoryG.generateRandomString(8).substring(0, 8),
            'Username' => DataFactoryG.generateRandomString(8) + '@test.com',
            'CommunityNickname' => DataFactoryG.generateRandomString(8),
            'EmailEncodingKey' => 'UTF-8',
            'LanguageLocaleKey' => 'fr',
            'LocaleSidKey' => 'fr_FR',
            'TimeZoneSidKey' => 'Europe/Paris',
            'ProfileId' => p.Id
        };
        
        // â–¶ï¸ ExÃ©cution du test
        Test.startTest();
        User u = (User)DataFactoryG.createSObject('User', userFields);
        insert u;
        Test.stopTest();
        
        // âœ… VÃ©rification
        User insertedUser = [SELECT Id, Username, Email FROM User WHERE Id = :u.Id];
        System.assertEquals(userFields.get('Email'), insertedUser.Email);
        System.assertEquals(userFields.get('Username'), insertedUser.Username);
    }
    
    //â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    //â”‚    TESTS DE GÃ‰OLOCALISATION             â”‚
    //â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    /**
     * @description Test de gÃ©nÃ©ration de coordonnÃ©es gÃ©ographiques
     */
    @IsTest
    static void testGeoLocation() {
        // ğŸ—ºï¸ GÃ©nÃ©ration des coordonnÃ©es
        Map<String, Double> coordinates = DataFactoryG.generateRandomGeoLocation();
        
        // âœ… VÃ©rifications de base
        System.assertNotEquals(null, coordinates.get('latitude'));
        System.assertNotEquals(null, coordinates.get('longitude'));
        
        // ğŸ“ VÃ©rification des limites gÃ©ographiques
        System.assert(coordinates.get('latitude') >= 41.3);
        System.assert(coordinates.get('latitude') <= 51.1);
        System.assert(coordinates.get('longitude') >= -4.8);
        System.assert(coordinates.get('longitude') <= 8.2);
    }
    
    //â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    //â”‚    TESTS DES RELATIONS                  â”‚
    //â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    /**
     * @description Test de crÃ©ation d'une hiÃ©rarchie parent-enfant
     */
    @IsTest
    static void testParentChildRelationship() {
        // ğŸ“ PrÃ©paration des donnÃ©es
        Map<String, Object> accountFields = new Map<String, Object>{
            'Name' => 'Test Account'
        };
        
        Map<String, Object> contactFields = new Map<String, Object>{
            'LastName' => 'Test Contact',
            'Email' => DataFactoryG.generateRandomEmail()
        };
        
        // â–¶ï¸ ExÃ©cution du test
        Test.startTest();
        Map<String, Object> hierarchy = DataFactoryG.createParentChildHierarchy(
            'Account',
            accountFields,
            'Contact',
            3,
            'AccountId',
            contactFields
        );
        Test.stopTest();
        
        // âœ… VÃ©rifications
        Account parentAccount = (Account)hierarchy.get('parent');
        List<Contact> childContacts = (List<Contact>)hierarchy.get('children');
        
        System.assertNotEquals(null, parentAccount.Id);
        System.assertEquals(3, childContacts.size());
        
        // ğŸ‘¨â€ğŸ‘¦ VÃ©rification des relations
        for(Contact c : childContacts) {
            System.assertEquals(parentAccount.Id, c.AccountId);
        }
    }
    
    /**
     * @description Test de crÃ©ation d'un enregistrement gÃ©olocalisÃ©
     */
    @IsTest
    static void testGeolocatedRecord() {
        // ğŸ“ PrÃ©paration des donnÃ©es
        Map<String, Object> additionalFields = new Map<String, Object>{
            'Name' => 'Test Location'
        };
        
        // â–¶ï¸ ExÃ©cution du test
        Test.startTest();
        Account acc = (Account)DataFactoryG.createGeolocatedRecord(
            'Account',
            'Latitude__c',
            'Longitude__c',
            additionalFields
        );
        Test.stopTest();
        
        // âœ… VÃ©rification
        Account insertedAcc = [SELECT Id, Name, Latitude__c, Longitude__c 
                             FROM Account 
                             WHERE Id = :acc.Id];
        
        System.assertNotEquals(null, insertedAcc.Latitude__c);
        System.assertNotEquals(null, insertedAcc.Longitude__c);
    }
    
    //â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    //â”‚    TESTS EVENT LOG FILE                  â”‚
    //â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    /**
     * @description Test de crÃ©ation d'un EventLogFile gÃ©nÃ©rique
     */
    @IsTest
    static void testCreateEventLogFile() {
        // ğŸ“ PrÃ©paration
        Id mockUserId = '005000000000000';
        Map<String, Object> additionalFields = new Map<String, Object>{
            'TEST_FIELD' => 'Test Value'
        };
        
        // â–¶ï¸ ExÃ©cution
        Test.startTest();
        EventLogFile result = DataFactoryG.createEventLogFile('Test', mockUserId, additionalFields);
        Test.stopTest();
        
        // âœ… VÃ©rifications
        System.assertNotEquals(null, result, 'L\'EventLogFile ne devrait pas Ãªtre null');
        System.assertEquals('Test', result.EventType, 'Le type d\'Ã©vÃ©nement devrait correspondre');
        
        // VÃ©rification du contenu JSON
        String content = result.LogFile.toString();
        Map<String, Object> jsonContent = (Map<String, Object>)JSON.deserializeUntyped(content);
        System.assertEquals(mockUserId, jsonContent.get('UserId'), 'L\'ID utilisateur devrait correspondre');
        System.assertEquals('Test Value', jsonContent.get('TEST_FIELD'), 'Le champ supplÃ©mentaire devrait Ãªtre prÃ©sent');
    }
    
    /**
     * @description Test de crÃ©ation d'un EventLogFile de type Login
     */
    @IsTest
    static void testCreateLoginEventLog() {
        // ğŸ“ PrÃ©paration
        Id mockUserId = '005000000000000';
        
        // â–¶ï¸ ExÃ©cution
        Test.startTest();
        EventLogFile result = DataFactoryG.createLoginEventLog(mockUserId);
        Test.stopTest();
        
        // âœ… VÃ©rifications
        System.assertNotEquals(null, result, 'L\'EventLogFile ne devrait pas Ãªtre null');
        System.assertEquals('Login', result.EventType, 'Le type d\'Ã©vÃ©nement devrait Ãªtre Login');
        
        // VÃ©rification du contenu JSON
        String content = result.LogFile.toString();
        Map<String, Object> jsonContent = (Map<String, Object>)JSON.deserializeUntyped(content);
        System.assertEquals('Application', jsonContent.get('LOGIN_TYPE'), 'Le type de login devrait Ãªtre Application');
        System.assertEquals('Success', jsonContent.get('STATUS'), 'Le statut devrait Ãªtre Success');
    }
    
    /**
     * @description Test de crÃ©ation d'un EventLogFile de type API
     */
    @IsTest
    static void testCreateAPIEventLog() {
        // ğŸ“ PrÃ©paration
        Id mockUserId = '005000000000000';
        
        // â–¶ï¸ ExÃ©cution
        Test.startTest();
        EventLogFile result = DataFactoryG.createAPIEventLog(mockUserId);
        Test.stopTest();
        
        // âœ… VÃ©rifications
        System.assertNotEquals(null, result, 'L\'EventLogFile ne devrait pas Ãªtre null');
        System.assertEquals('API', result.EventType, 'Le type d\'Ã©vÃ©nement devrait Ãªtre API');
        
        // VÃ©rification du contenu JSON
        String content = result.LogFile.toString();
        Map<String, Object> jsonContent = (Map<String, Object>)JSON.deserializeUntyped(content);
        System.assertEquals('Query', jsonContent.get('OPERATION'), 'L\'opÃ©ration devrait Ãªtre Query');
        System.assertEquals('200', jsonContent.get('STATUS_CODE'), 'Le code status devrait Ãªtre 200');
    }
    
    /**
     * @description Test de crÃ©ation d'un EventLogFile avec contenu CSV
     */
    @IsTest
    static void testCreateCSVEventLog() {
        // ğŸ“ PrÃ©paration
        Id mockUserId = '005000000000000';
        
        // â–¶ï¸ ExÃ©cution
        Test.startTest();
        EventLogFile result = DataFactoryG.createCSVEventLog(mockUserId);
        Test.stopTest();
        
        // âœ… VÃ©rifications
        System.assertNotEquals(null, result, 'L\'EventLogFile ne devrait pas Ãªtre null');
        System.assertEquals('Login', result.EventType, 'Le type d\'Ã©vÃ©nement devrait Ãªtre Login');
        
        // VÃ©rification du contenu CSV
        String content = result.LogFile.toString();
        List<String> lines = content.split('\n');
        System.assertEquals(2, lines.size(), 'Le fichier CSV devrait avoir 2 lignes');
        System.assert(lines[1].contains(mockUserId), 'L\'ID utilisateur devrait Ãªtre prÃ©sent dans le CSV');
    }
    
    /**
     * @description Test de crÃ©ation d'un EventLogFile invalide
     */
    @IsTest
    static void testCreateInvalidEventLog() {
        // â–¶ï¸ ExÃ©cution
        Test.startTest();
        EventLogFile result = DataFactoryG.createInvalidEventLog();
        Test.stopTest();
        
        // âœ… VÃ©rifications
        System.assertNotEquals(null, result, 'L\'EventLogFile ne devrait pas Ãªtre null');
        System.assertEquals('Unknown', result.EventType, 'Le type d\'Ã©vÃ©nement devrait Ãªtre Unknown');
        System.assertEquals('Contenu invalide', result.LogFile.toString(), 'Le contenu devrait Ãªtre invalide');
    }
} 