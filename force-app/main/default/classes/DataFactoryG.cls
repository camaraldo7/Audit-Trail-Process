/**
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚                     DATA FACTORY GENERATOR                               â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ GÃ©nÃ©ration de donnÃ©es de test pour Salesforce                            â”‚
 * â”‚ Version: 1.0                                                             â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 * @description       : Une classe DataFactoryG gÃ©nÃ©rique pour Salesforce Apex qui permettra de gÃ©nÃ©rer facilement des donnÃ©es de test.
 * @author            : Mamadou Lamine CAMARA
 * @group             : 
 * @last modified on  : 20-04-2025 
 * @last modified by  : Mamadou Lamine CAMARA
**/

public class DataFactoryG {
    
    //â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    //â”‚    CRÃ‰ATION D'OBJETS SIMPLES            â”‚
    //â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    /**
     * @description CrÃ©e un enregistrement SObject avec des champs remplis alÃ©atoirement
     * @param sObjectType Le type de SObject Ã  crÃ©er
     * @return L'instance SObject crÃ©Ã©e
     */
    public static SObject createSObject(String sObjectType) {
        return createSObject(sObjectType, null);
    }
    
    /**
     * @description CrÃ©e un enregistrement SObject avec des champs spÃ©cifiques
     * @param sObjectType Le type de SObject Ã  crÃ©er
     * @param fieldValues Map des valeurs de champs Ã  dÃ©finir
     * @return L'instance SObject crÃ©Ã©e
     */
    public static SObject createSObject(String sObjectType, Map<String,Object> fieldValues) {
        // ğŸ“¦ CrÃ©ation de l'objet
        SObject sObj = Schema.getGlobalDescribe().get(sObjectType).newSObject();
        
        // ğŸ”„ Application des valeurs de champs
        if(fieldValues != null) {
            for(String field : fieldValues.keySet()) {
                sObj.put(field, fieldValues.get(field));
            }
        }
        
        return sObj;
    }
    
    //â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    //â”‚    CRÃ‰ATION DE LISTES D'OBJETS          â”‚
    //â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    /**
     * @description CrÃ©e et insÃ¨re plusieurs enregistrements SObject
     * @param sObjectType Le type de SObject Ã  crÃ©er
     * @param count Le nombre d'enregistrements Ã  crÃ©er
     * @return Liste des SObjects crÃ©Ã©s et insÃ©rÃ©s
     */
    public static List<SObject> createSObjectList(String sObjectType, Integer count) {
        return createSObjectList(sObjectType, count, null);
    }
    
    /**
     * @description CrÃ©e et insÃ¨re plusieurs enregistrements SObject avec des champs spÃ©cifiques
     * @param sObjectType Le type de SObject Ã  crÃ©er
     * @param count Le nombre d'enregistrements Ã  crÃ©er
     * @param fieldValues Map des valeurs de champs Ã  dÃ©finir
     * @return Liste des SObjects crÃ©Ã©s et insÃ©rÃ©s
     */
    public static List<SObject> createSObjectList(String sObjectType, Integer count, Map<String,Object> fieldValues) {
        // ğŸ“‹ CrÃ©ation de la liste
        List<SObject> sObjects = new List<SObject>();
        
        // ğŸ”„ GÃ©nÃ©ration des objets
        for(Integer i = 0; i < count; i++) {
            sObjects.add(createSObject(sObjectType, fieldValues));
        }
        
        return sObjects;
    }
    
    //â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    //â”‚    GÃ‰NÃ‰RATEURS DE DONNÃ‰ES               â”‚
    //â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    /**
     * @description GÃ©nÃ¨re une chaÃ®ne alÃ©atoire
     * @param length Longueur de la chaÃ®ne souhaitÃ©e
     * @return ChaÃ®ne alÃ©atoire
     */
    public static String generateRandomString(Integer length) {
        // ğŸ² CaractÃ¨res possibles
        final String chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz';
        String randStr = '';
        
        while (randStr.length() < length) {
            Integer idx = Math.mod(Math.abs(Crypto.getRandomInteger()), chars.length());
            randStr += chars.substring(idx, idx + 1);
        }
        
        return randStr;
    }
    
    /**
     * @description GÃ©nÃ¨re un email alÃ©atoire
     * @return Email alÃ©atoire
     */
    public static String generateRandomEmail() {
        // ğŸ“§ GÃ©nÃ©ration d'email
        return generateRandomString(8) + '@' + generateRandomString(8) + '.com';
    }
    
    /**
     * @description GÃ©nÃ¨re un numÃ©ro de tÃ©lÃ©phone alÃ©atoire
     * @return NumÃ©ro de tÃ©lÃ©phone alÃ©atoire
     */
    public static String generateRandomPhone() {
        // ğŸ“± GÃ©nÃ©ration de numÃ©ro franÃ§ais
        String phone = '+33';
        for(Integer i = 0; i < 9; i++) {
            phone += String.valueOf(Math.mod(Math.abs(Crypto.getRandomInteger()), 10));
        }
        return phone;
    }

    /**
     * @description CrÃ©e une position gÃ©ographique alÃ©atoire en France mÃ©tropolitaine
     * @return Map avec Latitude et Longitude
     */
    public static Map<String, Double> generateRandomGeoLocation() {
        // ğŸ—ºï¸ CoordonnÃ©es de la France mÃ©tropolitaine
        Double minLat = 41.3;  // Sud de la France
        Double maxLat = 51.1;  // Nord de la France
        Double minLong = -4.8; // Ouest de la France
        Double maxLong = 8.2;  // Est de la France
        
        // ğŸ“ GÃ©nÃ©ration des coordonnÃ©es
        Decimal latitude = Decimal.valueOf(minLat + (Math.random() * (maxLat - minLat)));
        Decimal longitude = Decimal.valueOf(minLong + (Math.random() * (maxLong - minLong)));
        
        return new Map<String, Double>{
            'latitude' => latitude.setScale(6).doubleValue(),
            'longitude' => longitude.setScale(6).doubleValue()
        };
    }
    
    //â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    //â”‚    GESTION DES RELATIONS                â”‚
    //â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    /**
     * @description CrÃ©e une relation lookup ou master-detail
     * @param parentObjectType Type d'objet parent (ex: 'Account')
     * @param parentFields Champs Ã  dÃ©finir sur l'objet parent
     * @return ID de l'enregistrement parent crÃ©Ã©
     */
    public static Id createParentRecord(String parentObjectType, Map<String, Object> parentFields) {
        // ğŸ‘¨â€ğŸ‘¦ CrÃ©ation du parent
        SObject parent = createSObject(parentObjectType, parentFields);
        insert parent;
        return parent.Id;
    }
    
    /**
     * @description CrÃ©e plusieurs enregistrements enfants liÃ©s Ã  un parent
     * @param childObjectType Type d'objet enfant (ex: 'Contact')
     * @param parentId ID de l'enregistrement parent
     * @param lookupFieldName Nom du champ de relation (ex: 'AccountId')
     * @param count Nombre d'enregistrements enfants Ã  crÃ©er
     * @param additionalFields Champs supplÃ©mentaires pour les enfants
     * @return Liste des enregistrements enfants crÃ©Ã©s
     */
    public static List<SObject> createChildRecords(
        String childObjectType,
        Id parentId,
        String lookupFieldName,
        Integer count,
        Map<String, Object> additionalFields
    ) {
        // ğŸ‘¨â€ğŸ‘¦ Configuration de la relation
        if (additionalFields == null) {
            additionalFields = new Map<String, Object>();
        }
        additionalFields.put(lookupFieldName, parentId);
        
        // ğŸ“‹ CrÃ©ation des enfants
        List<SObject> children = createSObjectList(childObjectType, count, additionalFields);
        insert children;
        return children;
    }
    
    /**
     * @description CrÃ©e une hiÃ©rarchie complÃ¨te d'objets (parent avec enfants)
     * @param parentObjectType Type d'objet parent
     * @param parentFields Champs du parent
     * @param childObjectType Type d'objet enfant
     * @param childCount Nombre d'enfants
     * @param lookupFieldName Nom du champ de relation
     * @param childFields Champs des enfants
     * @return Map contenant le parent et la liste des enfants
     */
    public static Map<String, Object> createParentChildHierarchy(
        String parentObjectType,
        Map<String, Object> parentFields,
        String childObjectType,
        Integer childCount,
        String lookupFieldName,
        Map<String, Object> childFields
    ) {
        // ğŸ‘¨â€ğŸ‘¦ CrÃ©ation du parent
        SObject parent = createSObject(parentObjectType, parentFields);
        insert parent;
        
        // ğŸ‘¨â€ğŸ‘§â€ğŸ‘¦ CrÃ©ation des enfants
        List<SObject> children = createChildRecords(
            childObjectType,
            parent.Id,
            lookupFieldName,
            childCount,
            childFields
        );
        
        return new Map<String, Object>{
            'parent' => parent,
            'children' => children
        };
    }
    
    //â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    //â”‚    GÃ‰OLOCALISATION                      â”‚
    //â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    /**
     * @description CrÃ©e un enregistrement avec des coordonnÃ©es gÃ©ographiques
     * @param objectType Type d'objet
     * @param latitudeField Nom du champ de latitude
     * @param longitudeField Nom du champ de longitude
     * @param additionalFields Autres champs Ã  dÃ©finir
     * @return L'enregistrement crÃ©Ã© avec gÃ©olocalisation
     */
    public static SObject createGeolocatedRecord(
        String objectType,
        String latitudeField,
        String longitudeField,
        Map<String, Object> additionalFields
    ) {
        // ğŸŒ PrÃ©paration des champs
        if (additionalFields == null) {
            additionalFields = new Map<String, Object>();
        }
        
        // ğŸ“ GÃ©nÃ©ration des coordonnÃ©es
        Map<String, Double> coordinates = generateRandomGeoLocation();
        additionalFields.put(latitudeField, coordinates.get('latitude'));
        additionalFields.put(longitudeField, coordinates.get('longitude'));
        
        // ğŸ’¾ CrÃ©ation et sauvegarde
        SObject record = createSObject(objectType, additionalFields);
        insert record;
        return record;
    }
    
    //â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    //â”‚    EVENT LOG FILE GENERATION            â”‚
    //â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    /**
     * @description CrÃ©e un EventLogFile avec le contenu JSON spÃ©cifiÃ©
     * @param eventType Type d'Ã©vÃ©nement
     * @param userId ID de l'utilisateur
     * @param additionalFields Champs supplÃ©mentaires Ã  inclure dans le JSON
     * @return EventLogFile crÃ©Ã©
     */
    public static EventLogFile createEventLogFile(String eventType, Id userId, Map<String, Object> additionalFields) {
        Map<String, Object> content = new Map<String, Object>{
            'UserId' => userId,
            'EventType' => eventType,
            'Timestamp' => System.now().format('yyyy-MM-dd\'T\'HH:mm:ss\'Z\'')
        };
        
        if (additionalFields != null) {
            content.putAll(additionalFields);
        }
        
        EventLogFile logFile = new EventLogFile(
            EventType = eventType,
            LogDate = Date.today(),
            LogFile = Blob.valueOf(JSON.serializePretty(content))
        );
        
        return logFile;
    }
    
    /**
     * @description CrÃ©e un EventLogFile de type Login
     * @param userId ID de l'utilisateur
     * @return EventLogFile crÃ©Ã©
     */
    public static EventLogFile createLoginEventLog(Id userId) {
        Map<String, Object> additionalFields = new Map<String, Object>{
            'LOGIN_TYPE' => 'Application',
            'STATUS' => 'Success',
            'LOGIN_KEY' => '1234567890',
            'SOURCE_IP' => '192.168.1.1'
        };
        
        return createEventLogFile('Login', userId, additionalFields);
    }
    
    /**
     * @description CrÃ©e un EventLogFile de type API
     * @param userId ID de l'utilisateur
     * @return EventLogFile crÃ©Ã©
     */
    public static EventLogFile createAPIEventLog(Id userId) {
        Map<String, Object> additionalFields = new Map<String, Object>{
            'OPERATION' => 'Query',
            'STATUS_CODE' => '200',
            'API_VERSION' => '57.0',
            'ENDPOINT' => '/services/data/v57.0/query'
        };
        
        return createEventLogFile('API', userId, additionalFields);
    }
    
    /**
     * @description CrÃ©e un EventLogFile de type URI
     * @param userId ID de l'utilisateur
     * @return EventLogFile crÃ©Ã©
     */
    public static EventLogFile createURIEventLog(Id userId) {
        Map<String, Object> additionalFields = new Map<String, Object>{
            'URI' => '/apex/MyPage',
            'METHOD' => 'GET',
            'STATUS_CODE' => '200',
            'RESPONSE_TIME' => '150'
        };
        
        return createEventLogFile('URI', userId, additionalFields);
    }
    
    /**
     * @description CrÃ©e un EventLogFile de type Report
     * @param userId ID de l'utilisateur
     * @return EventLogFile crÃ©Ã©
     */
    public static EventLogFile createReportEventLog(Id userId) {
        Map<String, Object> additionalFields = new Map<String, Object>{
            'REPORT_ID' => '00O000000000001',
            'ROWS_PROCESSED' => '1000',
            'EXECUTION_TIME' => '2500',
            'STATUS' => 'Success'
        };
        
        return createEventLogFile('Report', userId, additionalFields);
    }
    
    /**
     * @description CrÃ©e un EventLogFile avec contenu CSV
     * @param userId ID de l'utilisateur
     * @return EventLogFile crÃ©Ã©
     */
    public static EventLogFile createCSVEventLog(Id userId) {
        String csvContent = 'USER_ID,LOGIN_TYPE,STATUS,TIMESTAMP\n' +
                          userId + ',Application,Success,' + System.now().format('yyyy-MM-dd\'T\'HH:mm:ss\'Z\'');
        
        EventLogFile logFile = new EventLogFile(
            EventType = 'Login',
            LogDate = Date.today(),
            LogFile = Blob.valueOf(csvContent)
        );
        
        return logFile;
    }
    
    /**
     * @description CrÃ©e un EventLogFile avec contenu invalide
     * @return EventLogFile crÃ©Ã©
     */
    public static EventLogFile createInvalidEventLog() {
        EventLogFile logFile = new EventLogFile(
            EventType = 'Unknown',
            LogDate = Date.today(),
            LogFile = Blob.valueOf('Contenu invalide')
        );
        
        return logFile;
    }
} 